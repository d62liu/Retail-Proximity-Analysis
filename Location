import requests
from geopy.distance import geodesic

API_KEY = 'AIzaSyCwOrAmMIIFJW7wgXlo1u8UYwcjw7FYfuk' 

def get_store_locations (query, location, radius=20000):
    url = f"https://maps.googleapis.com/maps/api/place/nearbysearch/json?location={location}&radius={radius}&keyword={query}&key={API_KEY}"
    response = requests.get(url)
    if response.status_code == 200:
        results = response.json().get('results', [])
        stores = []

        for place in results:
            name = place.get("name")
            address = place.get ('vicinity')
            lat = place['geometry']['location']['lat']
            lng = place['geometry']['location']['lng']
            stores.append({'name': name, 'address': address, 'lat':lat, 'lng': lng})
        return stores

    else:
        return "fail"
total_dollar_general = 0
total_dollar_tree = 0

location = "43.458493203719186, -80.51667084996238"
dollar_general_stores = get_store_locations('Dollar General', location)
dollar_tree_stores = get_store_locations('Dollar General', location)
print("Dollar General Stores:")
for store in dollar_general_stores:
    total_dollar_general += 1
    print(store)

print("Dollar Tree Stores:")
for store in dollar_tree_stores:
    total_dollar_general += 1
    print(store)

def calculate_distance(coord1, coord2):
    return geodesic(coord1, coord2).kilometers

def find_nearby_stores (general_stores, target_stores, radius = 1):
    for dollar_general in general_stores:
        general_coord = (general_stores['lat'], general_stores['lng'])
        nearby_stores = 0

        for target_store in target_stores:
            target_coord = (target_store['lat'], target_store['lng'])
            distance = calculate_distance(general_coord, target_coord)
            if distance <= radius:
                nearby_stores += 1
    print("dollar general has"+nearby_stores+" dollar tree within a radius of "+radius+"km")
find_nearby_stores(dollar_general_stores, dollar_tree_stores, radius = 1)



    




